<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript" src="../../js/broadcaster.js"></script>
    <script type="text/javascript" src="../../js/viewer.js"></script>
    <script type="text/javascript" src="test_util.js"></script>
    <script type="text/javascript" src="json2.js"></script>
    <script type="text/javascript" >
      var broadcaster_iframe = null;
      var viewer_iframe = null;
      var broadcaster = null;
      var viewer = null;

      // Initialisation
      jQuery(document).ready(function() {
          broadcaster_iframe = document.getElementById("broadcaster_iframe");          
          viewer_iframe = document.getElementById("viewer_iframe");          
          broadcaster = new MirrorDom.Broadcaster({
              iframe: broadcaster_iframe
          });

          viewer = new MirrorDom.Viewer({
              iframe: viewer_iframe,
              blank_page: "blank.html"
          });
      });

      // ************** UNIT TESTS ****************

      function apply_viewer_doc(doc) {
          var doc_elem = viewer.get_document_element();
          //debugger;
          viewer.apply_document(doc_elem, doc);
      }

      function apply_viewer_diffs(diff_str) {
          //debugger;
          var diffs = JSON.parse(diff_str);
          viewer.apply_diffs(null, diffs);
      }

      function get_diff() {
          //debugger;
          return broadcaster.get_diff();
      }

      // Note: Most of the javascript has been implemented in test_vml.py now,
      // go check there

      // *************** END TESTS *****************

    </script>
  </head>
  <body>
    <iframe id="broadcaster_iframe" name="broadcaster_iframe" src="test_vml_content.html" style="width: 100%; height: 200px"></iframe>
    <iframe id="viewer_iframe" name="viewer_iframe" src="blank.html" style="width: 100%; height: 200px"></iframe>
  </body>
</html>
